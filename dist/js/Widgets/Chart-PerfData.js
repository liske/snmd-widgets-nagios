define(["snmd-core/js/SVGWidget","snmd-core/js/SVGImpl/Chart","snmd-widgets-nagios/js/Utils","js-logger"],function(t,s,a,e){"use strict";var i=function(e,i,r){this.opts={title:"Performance Data",axis:[{max:100,scale:"linear"}],desc:r,dpi:.2,cls:t.srClassOpts(r,"Chart"),lcls:["snmd-lcl-Nag","snmd-lcl-NagPerf","snmd-lcl-NagPerfData"],mcls:["snmd-mcl-Nag","snmd-mcl-NagPerf","snmd-mcl-NagPerfData"],tcls:["snmd-tcl-Nag","snmd-tcl-NagPerf","snmd-tcl-NagPerfData"]},this.lines=[{name:"connections",axis:0,unit:" STA"}],this.desc=r,this.last=[];var n;for(n=0;n<r.topics.length;n++){this.last[r.topics[n]]=[];var l;for(l=0;l<this.lines.length;l++)this.last[r.topics[n]][l]=[]}this.chart=new s(e,i,this.opts,this.lines,a.qTipConfig(this,this.lines.map(function(t){return t.name})))};return i.prototype.handleUpdate=function(t,s){var i;try{i=JSON.parse(s)}catch(t){return void e.debug("[Nagios/Chart-PerfData] JSON error in performance data: "+t.message)}a.qTipUpdate(t,i,this);var r,n;for(r=0;r<this.lines.length;r++){this.last[t][r].val=0,this.last[t][r].state=0;try{n=parseInt(i.perf_data[this.lines[r].name].val,10),isNaN(n)||(this.last[t][r].val=n)}catch(s){e.debug("[Nagios/Chart-PerfData] Error processing performance data of "+t+"["+r+"]: "+s.message)}try{this.last[t][r].state=i.state}catch(t){e.debug("[Nagios/Chart-PerfData] Error processing state data: "+t.message)}}var l=[],c=0;for(r=0;r<this.lines.length;r++){l[r]=0;var h;for(h in this.last)l[r]+=this.last[h][r].val,c=Math.max(c,this.last[h][r].state)}this.chart.update(i._timestamp,l,c)},i});